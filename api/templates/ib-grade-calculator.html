{% extends "base.html" %}

{% block title %}IB Grade Calculator | Accurate IB Diploma Score Predictor{% endblock %}

{% block meta_description %}Calculate your predicted IB Diploma score with our accurate IB grade calculator. Input your subject grades, EE/TOK scores, and check if you'll meet the diploma requirements.{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto p-4">
    <div class="bg-white rounded-xl shadow-md overflow-hidden p-6 mb-8">
        <h1 class="text-2xl font-bold text-gray-800 mb-6">IB Diploma Grade Calculator</h1>
        
        <div x-data="ibGradeCalculator()" class="space-y-6">
            <!-- Subject Selection -->
            <div class="bg-blue-50 p-4 rounded-lg">
                <h2 class="text-lg font-semibold text-blue-800 mb-3">Select Your IB Subjects</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="subject1" class="block text-sm font-medium text-gray-700 mb-1">Subject 1</label>
                        <select id="subject1" x-model="subjects[0].name" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                            <option value="">Select Subject</option>
                            <option value="Language A">Language A</option>
                            <option value="Language B">Language B</option>
                            <option value="Individuals and Societies">Individuals and Societies</option>
                            <option value="Sciences">Sciences</option>
                            <option value="Mathematics">Mathematics</option>
                            <option value="Arts">Arts</option>
                        </select>
                        <input x-model="subjects[0].grade" type="number" min="1" max="7" class="w-full mt-2 px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500" placeholder="Grade (1-7)" aria-label="Subject 1 Grade">
                    </div>
                    <div>
                        <label for="subject2" class="block text-sm font-medium text-gray-700 mb-1">Subject 2</label>
                        <select id="subject2" x-model="subjects[1].name" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                            <option value="">Select Subject</option>
                            <option value="Language A">Language A</option>
                            <option value="Language B">Language B</option>
                            <option value="Individuals and Societies">Individuals and Societies</option>
                            <option value="Sciences">Sciences</option>
                            <option value="Mathematics">Mathematics</option>
                            <option value="Arts">Arts</option>
                        </select>
                        <input x-model="subjects[1].grade" type="number" min="1" max="7" class="w-full mt-2 px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500" placeholder="Grade (1-7)" aria-label="Subject 2 Grade">
                    </div>
                    <div>
                        <label for="subject3" class="block text-sm font-medium text-gray-700 mb-1">Subject 3</label>
                        <select id="subject3" x-model="subjects[2].name" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                            <option value="">Select Subject</option>
                            <option value="Language A">Language A</option>
                            <option value="Language B">Language B</option>
                            <option value="Individuals and Societies">Individuals and Societies</option>
                            <option value="Sciences">Sciences</option>
                            <option value="Mathematics">Mathematics</option>
                            <option value="Arts">Arts</option>
                        </select>
                        <input x-model="subjects[2].grade" type="number" min="1" max="7" class="w-full mt-2 px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500" placeholder="Grade (1-7)" aria-label="Subject 3 Grade">
                    </div>
                    <div>
                        <label for="subject4" class="block text-sm font-medium text-gray-700 mb-1">Subject 4</label>
                        <select id="subject4" x-model="subjects[3].name" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                            <option value="">Select Subject</option>
                            <option value="Language A">Language A</option>
                            <option value="Language B">Language B</option>
                            <option value="Individuals and Societies">Individuals and Societies</option>
                            <option value="Sciences">Sciences</option>
                            <option value="Mathematics">Mathematics</option>
                            <option value="Arts">Arts</option>
                        </select>
                        <input x-model="subjects[3].grade" type="number" min="1" max="7" class="w-full mt-2 px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500" placeholder="Grade (1-7)" aria-label="Subject 4 Grade">
                    </div>
                    <div>
                        <label for="subject5" class="block text-sm font-medium text-gray-700 mb-1">Subject 5</label>
                        <select id="subject5" x-model="subjects[4].name" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                            <option value="">Select Subject</option>
                            <option value="Language A">Language A</option>
                            <option value="Language B">Language B</option>
                            <option value="Individuals and Societies">Individuals and Societies</option>
                            <option value="Sciences">Sciences</option>
                            <option value="Mathematics">Mathematics</option>
                            <option value="Arts">Arts</option>
                        </select>
                        <input x-model="subjects[4].grade" type="number" min="1" max="7" class="w-full mt-2 px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500" placeholder="Grade (1-7)" aria-label="Subject 5 Grade">
                    </div>
                    <div>
                        <label for="subject6" class="block text-sm font-medium text-gray-700 mb-1">Subject 6</label>
                        <select id="subject6" x-model="subjects[5].name" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                            <option value="">Select Subject</option>
                            <option value="Language A">Language A</option>
                            <option value="Language B">Language B</option>
                            <option value="Individuals and Societies">Individuals and Societies</option>
                            <option value="Sciences">Sciences</option>
                            <option value="Mathematics">Mathematics</option>
                            <option value="Arts">Arts</option>
                        </select>
                        <input x-model="subjects[5].grade" type="number" min="1" max="7" class="w-full mt-2 px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500" placeholder="Grade (1-7)" aria-label="Subject 6 Grade">
                    </div>
                </div>
            </div>

            <!-- Core Requirements -->
            <div class="bg-purple-50 p-4 rounded-lg">
                <h2 class="text-lg font-semibold text-purple-800 mb-3">IB Diploma Core Requirements</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label for="extendedEssay" class="block text-sm font-medium text-gray-700 mb-1">Extended Essay (A-E)</label>
                        <select id="extendedEssay" x-model="extendedEssay" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                            <option value="A">A</option>
                            <option value="B">B</option>
                            <option value="C">C</option>
                            <option value="D">D</option>
                            <option value="E">E</option>
                        </select>
                    </div>
                    <div>
                        <label for="theoryOfKnowledge" class="block text-sm font-medium text-gray-700 mb-1">Theory of Knowledge (A-E)</label>
                        <select id="theoryOfKnowledge" x-model="theoryOfKnowledge" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                            <option value="A">A</option>
                            <option value="B">B</option>
                            <option value="C">C</option>
                            <option value="D">D</option>
                            <option value="E">E</option>
                        </select>
                    </div>
                    <div>
                        <label for="casCompletion" class="block text-sm font-medium text-gray-700 mb-1">CAS Completion</label>
                        <select id="casCompletion" x-model="casCompletion" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                            <option value="true">Completed</option>
                            <option value="false">Not Completed</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Calculate Button -->
            <button @click="calculateIBGrade()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-md transition duration-200">
                Calculate My IB Diploma Score
            </button>

            <!-- Results -->
            <div x-show="result !== null" x-transition class="bg-green-50 border border-green-200 rounded-md p-4">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <svg class="h-5 w-5 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                    </div>
                    <div class="ml-3">
                        <h2 class="text-lg font-medium text-green-800">IB Diploma Results</h2>
                        <div class="mt-1 text-green-700 space-y-1">
                            <p>Total Points: <span class="font-bold" x-text="result.totalPoints"></span>/45</p>
                            <p>Core Points: <span class="font-bold" x-text="result.corePoints"></span>/3</p>
                            <p>Subject Points: <span class="font-bold" x-text="result.subjectPoints"></span>/42</p>
                            <p>Diploma Awarded: <span class="font-bold" x-text="result.diplomaAwarded ? 'Yes' : 'No'"></span></p>
                            <p x-show="!result.diplomaAwarded" class="text-sm italic text-yellow-700" x-text="result.failureReason"></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Help Section -->
    <article class="bg-white rounded-xl shadow-md overflow-hidden p-6">
        <h2 class="text-xl font-semibold text-gray-800 mb-4">How to Calculate Your IB Diploma Score</h2>
        <p class="text-gray-600 mb-4">Our IB Grade Calculator helps you predict your International Baccalaureate Diploma score by calculating points from your subject grades and core components.</p>
        
        <section>
            <h3 class="font-semibold text-gray-700 mb-2">Understanding the IB Grading System</h3>
            <ul class="list-disc list-inside space-y-2 text-gray-600">
                <li><strong>6 Subjects:</strong> Each graded from 1 (lowest) to 7 (highest)</li>
                <li><strong>Core Points:</strong> Extended Essay and Theory of Knowledge combine for up to 3 bonus points</li>
                <li><strong>Total Score:</strong> 42 (subjects) + 3 (core) = 45 maximum points</li>
            </ul>
        </section>

        <section class="mt-4">
            <h3 class="font-semibold text-gray-700 mb-2">IB Diploma Requirements</h3>
            <ul class="list-disc list-inside space-y-2 text-gray-600">
                <li>Minimum 24 points total</li>
                <li>No grade 2 in any Higher Level subject</li>
                <li>No more than one grade 2 in Standard Level subjects</li>
                <li>No grade 1 in any subject</li>
                <li>Successful completion of Creativity, Activity, Service (CAS)</li>
                <li>Minimum grade D in both Extended Essay and Theory of Knowledge</li>
            </ul>
        </section>

        <p class="mt-4 text-sm text-gray-500">Note: This calculator provides an estimate based on standard IB Diploma criteria. Official IB results are determined by the International Baccalaureate Organization.</p>
    </article>
</div>

<script>
    function ibGradeCalculator() {
        return {
            subjects: Array(6).fill().map(() => ({ name: '', grade: null })),
            extendedEssay: 'C',
            theoryOfKnowledge: 'C',
            casCompletion: 'true',
            result: null,
            
            calculateIBGrade() {
                // Calculate subject points (1-7 for each of 6 subjects)
                const subjectPoints = this.subjects
                    .filter(subject => subject.grade !== null && subject.name)
                    .reduce((sum, subject) => sum + (parseInt(subject.grade) || 0), 0);
                
                // Calculate core points from EE and TOK (A=3, B=2, C=1, D/E=0)
                const eePoints = {'A': 3, 'B': 2, 'C': 1, 'D': 0, 'E': 0}[this.extendedEssay] || 0;
                const tokPoints = {'A': 3, 'B': 2, 'C': 1, 'D': 0, 'E': 0}[this.theoryOfKnowledge] || 0;
                const corePoints = Math.min(eePoints + tokPoints, 3);
                
                const totalPoints = subjectPoints + corePoints;
                const casCompleted = this.casCompletion === 'true';
                
                // Check diploma requirements
                let diplomaAwarded = true;
                let failureReason = '';
                
                // Basic requirements
                if (totalPoints < 24) {
                    diplomaAwarded = false;
                    failureReason = 'Minimum 24 points required';
                } else if (!casCompleted) {
                    diplomaAwarded = false;
                    failureReason = 'CAS requirements not met';
                }
                
                // Subject grade requirements
                const grades = this.subjects.map(s => parseInt(s.grade)).filter(g => !isNaN(g));
                const grade2Count = grades.filter(g => g === 2).length;
                const grade1Count = grades.filter(g => g === 1).length;
                
                if (grade1Count > 0) {
                    diplomaAwarded = false;
                    failureReason = 'Grade 1 in any subject is failing';
                } else if (grade2Count > 2) {
                    diplomaAwarded = false;
                    failureReason = 'More than two grade 2s is failing';
                } else if (grade2Count > 0) {
                    // Check if grade 2s are in HL subjects
                    const hasHLGrade2 = this.subjects.some(s => parseInt(s.grade) === 2);
                    if (hasHLGrade2) {
                        diplomaAwarded = false;
                        failureReason = 'Grade 2 in HL subject is failing';
                    }
                }
                
                this.result = {
                    totalPoints: totalPoints,
                    corePoints: corePoints,
                    subjectPoints: subjectPoints,
                    diplomaAwarded: diplomaAwarded,
                    failureReason: failureReason
                };
            }
        }
    }
</script>
{% endblock %}